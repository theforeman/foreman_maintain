name: Ruby Tests
on: pull_request

jobs:
  Test_ruby_2_0_0:
    runs-on: ubuntu-18.04
    strategy:
      fail-fast: false
    steps:
      - uses: actions/checkout@v2
      - name: Install RVM
        run: |
          gpg --keyserver hkps://keys.openpgp.org --recv-keys 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
          \curl -sSL https://get.rvm.io | bash -s stable
          source $HOME/.rvm/scripts/rvm
          rvm install 2.0.0
      - name: Setup
        run: |
          source $HOME/.rvm/scripts/rvm
          rvm use 2.0.0
          gem install bundler -v '~> 1.3'
          bundle install --jobs=3 --retry=3
      - name: Run tests
        run: |
          source $HOME/.rvm/scripts/rvm
          rvm use 2.0.0
          bundle exec rake
  Test_ruby:
    runs-on: ubuntu-18.04
    strategy:
      fail-fast: false
      matrix:
        ruby-version: [22, 24, 25, 26]
        centos: ["7"]
    container:
      image: centos/ruby-${{ matrix.ruby-version }}-centos${{matrix.centos}}
    steps:
      - uses: actions/checkout@v2
      - name: Setup
        run: |
          sudo yum install rubygems ruby-devel -y
          gem install bundler
          bundle install --jobs=3 --retry=3
      - name: Run tests
        run: |
          bundle exec rake
